(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,34221,e=>{"use strict";var t=e.i(56135),a=e.i(91543),s=e.i(58129);let r="/api/v1";function l(){let{token:e}=(0,s.useAuth)(),[l,i]=(0,a.useState)([]),[n,d]=(0,a.useState)(!1),[o,c]=(0,a.useState)(0),u=(0,a.useRef)(null),h=async()=>{if(e)try{let t=await fetch(`${r}/notifications`,{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let e=await t.json();i(e),c(e.filter(e=>!e.is_read).length)}}catch(e){console.error(e)}};(0,a.useEffect)(()=>{h();let e=setInterval(h,1e4);return()=>clearInterval(e)},[e]),(0,a.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let m=async t=>{try{await fetch(`${r}/notifications/${t}/read`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`}}),i(e=>e.map(e=>e.id===t?{...e,is_read:!0}:e)),c(e=>Math.max(0,e-1))}catch(e){}},g=async()=>{try{await fetch(`${r}/notifications/read-all`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`}}),i(e=>e.map(e=>({...e,is_read:!0}))),c(0)}catch(e){}},_=async(t,a)=>{t.stopPropagation();try{(await fetch(`${r}/notifications/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}})).ok&&i(e=>{let t=e.find(e=>e.id===a),s=e.filter(e=>e.id!==a);return t&&!t.is_read&&c(e=>Math.max(0,e-1)),s})}catch(e){console.error("Lá»—i xÃ³a thÃ´ng bÃ¡o",e)}};return(0,t.jsxs)("div",{className:"relative",ref:u,children:[(0,t.jsxs)("button",{onClick:()=>d(!n),className:"relative p-2 rounded-full hover:bg-gray-100 transition-colors",children:[(0,t.jsx)("span",{className:"text-xl",children:"ðŸ””"}),o>0&&(0,t.jsx)("span",{className:"absolute top-0 right-0 w-4 h-4 bg-red-500 text-white text-[10px] font-bold flex items-center justify-center rounded-full border border-white",children:o>9?"9+":o})]}),n&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 animate-fade-in overflow-hidden origin-top-right",children:[(0,t.jsxs)("div",{className:"p-3 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[(0,t.jsx)("h3",{className:"font-bold text-sm text-gray-700",children:"ThÃ´ng bÃ¡o"}),o>0&&(0,t.jsx)("button",{onClick:g,className:"text-xs text-indigo-600 hover:underline font-medium",children:"Äá»c táº¥t cáº£"})]}),(0,t.jsx)("div",{className:"max-h-80 overflow-y-auto custom-scrollbar",children:0===l.length?(0,t.jsx)("div",{className:"p-8 text-center text-gray-400 text-xs",children:"KhÃ´ng cÃ³ thÃ´ng bÃ¡o má»›i"}):l.map(e=>{let a;return(0,t.jsxs)("div",{onClick:()=>!e.is_read&&m(e.id),className:`p-3 border-b border-gray-50 cursor-pointer transition-colors relative group ${e.is_read?"bg-white opacity-60 hover:bg-gray-50":"bg-blue-50/40 hover:bg-blue-50"}`,children:[(0,t.jsx)("button",{onClick:t=>_(t,e.id),className:"absolute top-2 right-2 w-5 h-5 flex items-center justify-center rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-all z-10",title:"XÃ³a thÃ´ng bÃ¡o",children:"Ã—"}),(0,t.jsxs)("div",{className:"flex justify-between items-start mb-1 pr-5",children:[(0,t.jsx)("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded uppercase tracking-wider ${"OVERDUE"===e.type?"bg-red-100 text-red-600":"ASSIGN"===e.type?"bg-green-100 text-green-600":"bg-gray-100 text-gray-600"}`,children:e.type}),(0,t.jsx)("span",{className:"text-[10px] text-gray-400",children:(a=new Date(e.created_at),`${a.getHours()}:${a.getMinutes()} - ${a.getDate()}/${a.getMonth()+1}`)})]}),(0,t.jsx)("p",{className:`text-sm text-gray-800 mb-0.5 ${!e.is_read?"font-semibold":""}`,children:e.title}),(0,t.jsx)("p",{className:"text-xs text-gray-500 line-clamp-2 leading-snug",children:e.message})]},e.id)})})]})]})}e.s(["default",()=>l])},11489,e=>{e.v({adminFilter:"styles-module__59JyHW__adminFilter",card:"styles-module__59JyHW__card",cardContent:"styles-module__59JyHW__cardContent",cardIconBg:"styles-module__59JyHW__cardIconBg",cardLabel:"styles-module__59JyHW__cardLabel",cardValue:"styles-module__59JyHW__cardValue",cardValueContainer:"styles-module__59JyHW__cardValueContainer",container:"styles-module__59JyHW__container",fadeIn:"styles-module__59JyHW__fadeIn",filterLabel:"styles-module__59JyHW__filterLabel",filterSelect:"styles-module__59JyHW__filterSelect",grid:"styles-module__59JyHW__grid",group:"styles-module__59JyHW__group",header:"styles-module__59JyHW__header",iconBgDefault:"styles-module__59JyHW__iconBgDefault",iconBgWarning:"styles-module__59JyHW__iconBgWarning",subtitle:"styles-module__59JyHW__subtitle",title:"styles-module__59JyHW__title",valueDefault:"styles-module__59JyHW__valueDefault",valueWarning:"styles-module__59JyHW__valueWarning"})},77081,e=>{"use strict";var t=e.i(56135),a=e.i(91543),s=e.i(58129),r=e.i(96504),l=e.i(34221),i=e.i(11489);let n="/api/v1";function d(){let{user:e,token:d,loading:c,logout:u}=(0,s.useAuth)(),h=(0,r.useRouter)(),[m,g]=(0,a.useState)(null),[_,f]=(0,a.useState)(null),[x,y]=(0,a.useState)(!0),[b,p]=(0,a.useState)([]),[v,j]=(0,a.useState)("");return((0,a.useEffect)(()=>{c||e||h.push("/login")},[e,c,h]),(0,a.useEffect)(()=>{e?.role==="ADMIN"&&d&&fetch(`${n}/users?limit=100`,{headers:{Authorization:`Bearer ${d}`}}).then(e=>e.json()).then(e=>{p(Array.isArray(e)?e:e.data||[])}).catch(console.error)},[e,d]),(0,a.useEffect)(()=>{e&&d&&(async()=>{y(!0);try{let t=`${n}/dashboard`;"ADMIN"===e.role&&v&&(t+=`?userId=${v}`);let a=await fetch(t,{headers:{Authorization:`Bearer ${d}`}}),s=await a.json();if(!a.ok)throw Error(s.message);g(s)}catch(e){f(e.message)}finally{y(!1)}})()},[e,d,v]),c||x||!e)?(0,t.jsx)("div",{className:"p-8 text-center",children:"Äang táº£i dá»¯ liá»‡u tá»•ng quan..."}):(0,t.jsxs)("div",{className:i.default.container,children:[(0,t.jsxs)("header",{className:i.default.header,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:i.default.title,children:v?"Chi tiáº¿t nhÃ¢n viÃªn":`Ch\xe0o má»«ng, ${e.username}!`}),(0,t.jsx)("p",{className:i.default.subtitle,children:"Tá»•ng quan hiá»‡u suáº¥t cÃ´ng viá»‡c."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(l.default,{}),"ADMIN"===e.role&&(0,t.jsxs)("div",{className:i.default.adminFilter,children:[(0,t.jsx)("span",{className:i.default.filterLabel,children:"Xem theo:"}),(0,t.jsxs)("select",{className:i.default.filterSelect,value:v,onChange:e=>j(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"ToÃ n há»‡ thá»‘ng"}),b.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.username," (",e.role,")"]},e.id))]})]})]})]}),_&&(0,t.jsxs)("div",{className:"text-red-500 mb-4 bg-red-50 p-3 rounded-lg border border-red-100",children:["Lá»—i: ",_]}),m&&(0,t.jsxs)("div",{className:i.default.grid,children:[(0,t.jsx)(o,{title:"Tá»•ng Dá»± Ãn",value:m.projects?.total_projects}),(0,t.jsx)(o,{title:"Dá»± Ãn HoÃ n ThÃ nh",value:m.projects?.completed_projects}),(0,t.jsx)(o,{title:"Tá»•ng CÃ´ng Viá»‡c",value:m.tasks?.total_tasks}),(0,t.jsx)(o,{title:"CÃ´ng Viá»‡c Trá»… Háº¡n",value:m.tasks?.overdue_tasks,isWarning:!0})]})]})}function o({title:e,value:a,isWarning:s=!1}){return(0,t.jsxs)("div",{className:`${i.default.card} group`,children:[(0,t.jsx)("div",{className:`${i.default.cardIconBg} ${s?i.default.iconBgWarning:i.default.iconBgDefault}`}),(0,t.jsxs)("div",{className:i.default.cardContent,children:[(0,t.jsx)("p",{className:i.default.cardLabel,children:e}),(0,t.jsx)("div",{className:i.default.cardValueContainer,children:(0,t.jsx)("span",{className:`${i.default.cardValue} ${s?i.default.valueWarning:i.default.valueDefault}`,children:a||0})})]})]})}e.s(["default",()=>d])}]);