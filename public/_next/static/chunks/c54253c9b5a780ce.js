(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54191,e=>{e.v({addSubBtn:"styles-module__TuB0xq__addSubBtn",badgeHigh:"styles-module__TuB0xq__badgeHigh",badgeLow:"styles-module__TuB0xq__badgeLow",badgeMedium:"styles-module__TuB0xq__badgeMedium",badgePriority:"styles-module__TuB0xq__badgePriority",badgeUrgent:"styles-module__TuB0xq__badgeUrgent",btnCancel:"styles-module__TuB0xq__btnCancel",btnSave:"styles-module__TuB0xq__btnSave",closeBtn:"styles-module__TuB0xq__closeBtn",container:"styles-module__TuB0xq__container",createTaskBtn:"styles-module__TuB0xq__createTaskBtn",editActions:"styles-module__TuB0xq__editActions",emptyState:"styles-module__TuB0xq__emptyState",expandBtn:"styles-module__TuB0xq__expandBtn",fadeIn:"styles-module__TuB0xq__fadeIn",formActions:"styles-module__TuB0xq__formActions",formContainer:"styles-module__TuB0xq__formContainer",formHeader:"styles-module__TuB0xq__formHeader",formRow2:"styles-module__TuB0xq__formRow2",formTitle:"styles-module__TuB0xq__formTitle",guideLineH:"styles-module__TuB0xq__guideLineH",guideLineV:"styles-module__TuB0xq__guideLineV",header:"styles-module__TuB0xq__header",headerActions:"styles-module__TuB0xq__headerActions",headerContent:"styles-module__TuB0xq__headerContent",iconBtn:"styles-module__TuB0xq__iconBtn",iconBtnDelete:"styles-module__TuB0xq__iconBtnDelete",inputField:"styles-module__TuB0xq__inputField",inputGroup:"styles-module__TuB0xq__inputGroup",inputLabel:"styles-module__TuB0xq__inputLabel",inviteForm:"styles-module__TuB0xq__inviteForm",mainContent:"styles-module__TuB0xq__mainContent",memberBtn:"styles-module__TuB0xq__memberBtn",memberInfo:"styles-module__TuB0xq__memberInfo",memberList:"styles-module__TuB0xq__memberList",memberRoleBadge:"styles-module__TuB0xq__memberRoleBadge",memberRow:"styles-module__TuB0xq__memberRow",metaItem:"styles-module__TuB0xq__metaItem",modalBody:"styles-module__TuB0xq__modalBody",modalContainer:"styles-module__TuB0xq__modalContainer",modalFooter:"styles-module__TuB0xq__modalFooter",modalHeader:"styles-module__TuB0xq__modalHeader",modalOverlay:"styles-module__TuB0xq__modalOverlay",modalTitle:"styles-module__TuB0xq__modalTitle",projectStatus:"styles-module__TuB0xq__projectStatus",projectStatusLabel:"styles-module__TuB0xq__projectStatusLabel",projectStatusSelect:"styles-module__TuB0xq__projectStatusSelect",projectStatusSelectWrapper:"styles-module__TuB0xq__projectStatusSelectWrapper",projectTitle:"styles-module__TuB0xq__projectTitle",projectTitleWrapper:"styles-module__TuB0xq__projectTitleWrapper",roleAdmin:"styles-module__TuB0xq__roleAdmin",roleMember:"styles-module__TuB0xq__roleMember",rolePM:"styles-module__TuB0xq__rolePM",statusCompleted:"styles-module__TuB0xq__statusCompleted",statusDefault:"styles-module__TuB0xq__statusDefault",statusDone:"styles-module__TuB0xq__statusDone",statusProgress:"styles-module__TuB0xq__statusProgress",statusSelectDisabled:"styles-module__TuB0xq__statusSelectDisabled",statusSelectSmall:"styles-module__TuB0xq__statusSelectSmall",subTaskFormContainer:"styles-module__TuB0xq__subTaskFormContainer",tabActive:"styles-module__TuB0xq__tabActive",tabBtn:"styles-module__TuB0xq__tabBtn",tabContainer:"styles-module__TuB0xq__tabContainer",tabInactive:"styles-module__TuB0xq__tabInactive",taskCard:"styles-module__TuB0xq__taskCard",taskCardActive:"styles-module__TuB0xq__taskCardActive",taskCardDisabled:"styles-module__TuB0xq__taskCardDisabled",taskDesc:"styles-module__TuB0xq__taskDesc",taskHeader:"styles-module__TuB0xq__taskHeader",taskInfo:"styles-module__TuB0xq__taskInfo",taskLeft:"styles-module__TuB0xq__taskLeft",taskMeta:"styles-module__TuB0xq__taskMeta",taskRight:"styles-module__TuB0xq__taskRight",taskTitle:"styles-module__TuB0xq__taskTitle",taskTitleDone:"styles-module__TuB0xq__taskTitleDone",taskWrapper:"styles-module__TuB0xq__taskWrapper",taskWrapperChild:"styles-module__TuB0xq__taskWrapperChild",treeNode:"styles-module__TuB0xq__treeNode"})},18512,e=>{"use strict";var t=e.i(56135),s=e.i(91543),a=e.i(58129),l=e.i(96504),i=e.i(87402),n=e.i(88776),r=e.i(54361);function d({projectId:e,token:a}){let[l,i]=(0,s.useState)(null),[r,d]=(0,s.useState)(!0),o=async()=>{try{let t=await fetch(`/api/v1/projects/${e}/report`,{headers:{Authorization:`Bearer ${a}`}});t.ok&&i(await t.json())}catch(e){console.error(e)}finally{d(!1)}};return((0,s.useEffect)(()=>{o()},[e]),r)?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Äang táº£i bÃ¡o cÃ¡o..."}):(0,t.jsx)("div",{className:"mt-6 animate-fade-in",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,t.jsx)("span",{className:"text-2xl",children:"ğŸ“Š"}),(0,t.jsx)("h3",{className:"font-bold text-gray-900 text-lg",children:"Hiá»‡u suáº¥t thÃ nh viÃªn"})]}),(0,t.jsx)("div",{className:"overflow-x-auto rounded-lg border border-gray-100",children:(0,t.jsxs)("table",{className:"min-w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-gray-50 text-gray-500 font-semibold uppercase text-xs tracking-wider",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4",children:"ThÃ nh viÃªn"}),(0,t.jsx)("th",{className:"px-6 py-4 text-center",children:"Tá»•ng viá»‡c"}),(0,t.jsx)("th",{className:"px-6 py-4 text-center text-green-700",children:"HoÃ n thÃ nh"}),(0,t.jsx)("th",{className:"px-6 py-4 text-center text-red-600",children:"Trá»… háº¡n"}),(0,t.jsx)("th",{className:"px-6 py-4 text-right w-1/3",children:"Tiáº¿n Ä‘á»™"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-gray-100 bg-white",children:[l?.members.map(e=>{let s=parseInt(e.assigned_tasks),a=parseInt(e.done_tasks),l=s>0?Math.round(a/s*100):0;return(0,t.jsxs)("tr",{className:"hover:bg-indigo-50/30 transition-colors",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(n.default,{name:e.username,size:"sm"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-900 block",children:e.username}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:e.email})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 text-center text-gray-600 font-medium bg-gray-50/50",children:s}),(0,t.jsx)("td",{className:"px-6 py-4 text-center text-green-600 font-bold",children:a}),(0,t.jsx)("td",{className:"px-6 py-4 text-center text-red-500 font-medium",children:e.overdue_tasks}),(0,t.jsx)("td",{className:"px-6 py-4 text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3",children:[(0,t.jsxs)("span",{className:"text-xs font-bold text-gray-600 w-8",children:[l,"%"]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden shadow-inner",children:(0,t.jsx)("div",{className:`h-full rounded-full transition-all duration-1000 shadow-sm ${100===l?"bg-green-500":l>75?"bg-indigo-500":l>25?"bg-blue-400":"bg-orange-400"}`,style:{width:`${l}%`}})})]})})]},e.user_id)}),l?.members.length===0&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"5",className:"text-center py-12 text-gray-400",children:"ChÆ°a cÃ³ thÃ nh viÃªn nÃ o trong dá»± Ã¡n."})})]})]})})]})})}let o="/api/v1";function c({taskId:e,projectId:a,token:l,canEdit:n}){let[d,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(!1),[h,x]=(0,s.useState)({isOpen:!1,fileId:null,fileName:""}),[_,p]=(0,s.useState)(!1),f=async()=>{try{let t=e?`taskId=${e}`:`projectId=${a}`,s=await fetch(`${o}/attachments?${t}`,{headers:{Authorization:`Bearer ${l}`}});s.ok&&c(await s.json())}catch(e){console.error(e)}};(0,s.useEffect)(()=>{f()},[e,a]);let g=async t=>{let s=t.target.files[0];if(!s)return;let n=new FormData;n.append("file",s),e&&n.append("taskId",e),a&&n.append("projectId",a),m(!0);try{(await fetch(`${o}/attachments`,{method:"POST",headers:{Authorization:`Bearer ${l}`},body:n})).ok?(i.default.success("Upload thÃ nh cÃ´ng"),f()):i.default.error("Lá»—i upload")}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{m(!1),t.target.value=null}},j=async()=>{if(h.fileId){p(!0);try{(await fetch(`${o}/attachments/${h.fileId}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok?(c(e=>e.filter(e=>e.id!==h.fileId)),i.default.success("ÄÃ£ xÃ³a file"),x({isOpen:!1,fileId:null,fileName:""})):i.default.error("Lá»—i khi xÃ³a file")}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{p(!1)}}};return(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("h5",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider",children:["Tá»‡p Ä‘Ã­nh kÃ¨m (",d.length,")"]}),n&&(0,t.jsxs)("label",{className:"cursor-pointer text-[10px] bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded flex items-center gap-1 transition-colors",children:[(0,t.jsx)("span",{children:u?"...":"ğŸ“ Upload"}),(0,t.jsx)("input",{type:"file",className:"hidden",onChange:g,disabled:u})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:d.map(e=>{var s;return(0,t.jsxs)("div",{className:"relative group bg-gray-50 p-2 rounded border border-gray-200 flex items-center gap-2 hover:bg-white hover:shadow-sm transition-all",children:[(0,t.jsx)("span",{className:"text-lg",children:(s=e.file_type).includes("image")?"ğŸ–¼ï¸":s.includes("pdf")?"ğŸ“„":"ğŸ“"}),(0,t.jsxs)("div",{className:"overflow-hidden flex-1",children:[(0,t.jsx)("a",{href:e.file_path,target:"_blank",rel:"noopener noreferrer",download:e.file_name,className:"text-xs text-indigo-600 font-medium hover:underline truncate block",title:e.file_name,children:e.file_name}),e.file_type.includes("image")&&(0,t.jsx)("div",{className:"mt-1 h-12 w-full relative rounded overflow-hidden bg-gray-200 border border-gray-100",children:(0,t.jsx)("img",{src:e.file_path,alt:"preview",className:"object-cover w-full h-full"})})]}),n&&(0,t.jsx)("button",{onClick:()=>{x({isOpen:!0,fileId:e.id,fileName:e.file_name})},className:"absolute top-1 right-1 bg-white rounded-full w-5 h-5 flex items-center justify-center text-red-500 shadow-sm border border-gray-200 opacity-0 group-hover:opacity-100 transition-all text-xs hover:bg-red-50 cursor-pointer",title:"XÃ³a file",children:"Ã—"})]},e.id)})}),(0,t.jsx)(r.default,{isOpen:h.isOpen,title:"XÃ³a tá»‡p Ä‘Ã­nh kÃ¨m?",message:`Báº¡n c\xf3 cháº¯c muá»‘n x\xf3a file "${h.fileName}" kh\xf4ng? H\xe0nh Ä‘á»™ng n\xe0y kh\xf4ng thá»ƒ ho\xe0n t\xe1c.`,onConfirm:j,onCancel:()=>x({isOpen:!1,fileId:null,fileName:""}),isLoading:_})]})}var u=e.i(34221),m=e.i(54191);let h="/api/v1",x=e=>{if(!e)return"";let t=new Date(e),s=6e4*t.getTimezoneOffset();return new Date(t-s).toISOString().slice(0,16)},_=e=>e?new Date(e).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",p=({onSubmit:e,onCancel:a,members:l,isSaving:i,autoFocus:n=!1,initialData:r=null,isSubForm:d=!1})=>{let[o,c]=(0,s.useState)({title:r?.title||"",description:r?.description||"",start_date:x(r?.start_date),due_date:x(r?.due_date),priority:r?.priority||"MEDIUM",assignee_id:r?.assignee_id||""}),u=e=>c(t=>({...t,[e.target.name]:e.target.value}));return(0,t.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),!o.title.trim())return;let s={...o};r||(s.start_date=new Date().toISOString()),e(s)},className:d?m.default.subTaskFormContainer:m.default.formContainer,children:[(0,t.jsxs)("div",{className:m.default.formHeader,children:[(0,t.jsx)("h4",{className:m.default.formTitle,children:r?"Chá»‰nh sá»­a cÃ´ng viá»‡c":"Táº¡o cÃ´ng viá»‡c má»›i"}),r&&(0,t.jsxs)("span",{className:"text-[10px] text-gray-400",children:["NgÃ y táº¡o: ",_(r.created_at)]})]}),(0,t.jsxs)("div",{className:m.default.inputGroup,children:[(0,t.jsxs)("label",{className:m.default.inputLabel,children:["TÃªn cÃ´ng viá»‡c ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{name:"title",autoFocus:n,required:!0,className:m.default.inputField,value:o.title,onChange:u,placeholder:"Nháº­p tÃªn cÃ´ng viá»‡c..."})]}),(0,t.jsxs)("div",{className:m.default.inputGroup,children:[(0,t.jsx)("label",{className:m.default.inputLabel,children:"MÃ´ táº£"}),(0,t.jsx)("textarea",{name:"description",rows:"2",className:m.default.inputField,value:o.description,onChange:u,placeholder:"MÃ´ táº£ chi tiáº¿t..."})]}),(0,t.jsxs)("div",{className:m.default.formRow2,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:m.default.inputLabel,children:"Háº¡n chÃ³t"}),(0,t.jsx)("input",{type:"datetime-local",name:"due_date",className:m.default.inputField,value:o.due_date,onChange:u})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:m.default.inputLabel,children:"Æ¯u tiÃªn"}),(0,t.jsxs)("select",{name:"priority",className:m.default.inputField,value:o.priority,onChange:u,children:[(0,t.jsx)("option",{value:"LOW",children:"Tháº¥p"}),(0,t.jsx)("option",{value:"MEDIUM",children:"Trung bÃ¬nh"}),(0,t.jsx)("option",{value:"HIGH",children:"Cao"}),(0,t.jsx)("option",{value:"URGENT",children:"Kháº©n cáº¥p"})]})]})]}),(0,t.jsxs)("div",{className:m.default.inputGroup,children:[(0,t.jsx)("label",{className:m.default.inputLabel,children:"Giao cho ai?"}),(0,t.jsxs)("select",{name:"assignee_id",className:m.default.inputField,value:o.assignee_id,onChange:u,children:[(0,t.jsx)("option",{value:"",children:"-- ChÆ°a phÃ¢n cÃ´ng --"}),l.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.username," (",e.email,")"]},e.id))]})]}),(0,t.jsxs)("div",{className:m.default.formActions,children:[(0,t.jsx)("button",{type:"button",onClick:a,className:m.default.btnCancel,children:"Há»§y"}),(0,t.jsx)("button",{type:"submit",disabled:i,className:m.default.btnSave,children:i?"LÆ°u...":"LÆ°u"})]})]})},f=({task:e,level:a=0,projectId:l,token:n,onRefresh:r,members:d,currentUser:o,onRequestDelete:u})=>{var x;let g,[j,y]=(0,s.useState)(!0),[b,v]=(0,s.useState)(!1),[N,T]=(0,s.useState)(!1),[B,S]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),q=o?.role==="ADMIN"||o?.role==="PM"||e.assignee_id===o?.id,$=o?.role==="ADMIN"||o?.role==="PM",w=d.find(t=>t.id===e.assignee_id)?.username||"ChÆ°a giao",D=async t=>{if(!q)return void i.default.error("Báº¡n khÃ´ng Ä‘Æ°á»£c phÃ¢n cÃ´ng cÃ´ng viá»‡c nÃ y!");C(!0);try{let s=await fetch(`${h}/projects/${l}/tasks/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({status:t})}),a=await s.json();s.ok?(r(),i.default.success("ÄÃ£ cáº­p nháº­t tráº¡ng thÃ¡i")):i.default.error(a.message||"KhÃ´ng thá»ƒ cáº­p nháº­t")}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{C(!1)}},I=async t=>{S(!0);try{let s=await fetch(`${h}/projects/${l}/tasks/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({...t,assignee_id:t.assignee_id||null})}),a=await s.json();s.ok?(T(!1),r(),i.default.success("ÄÃ£ cáº­p nháº­t")):i.default.error(a.message)}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{S(!1)}},O=async t=>{S(!0);try{let s=await fetch(`${h}/projects/${l}/tasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({...t,parent_id:e.id,assignee_id:t.assignee_id||null})}),a=await s.json();s.ok?(v(!1),y(!0),r(),i.default.success("ÄÃ£ thÃªm con")):i.default.error(a.message)}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{S(!1)}};return N?(0,t.jsx)("div",{className:`mt-4 ${a>0?"ml-8":""}`,children:(0,t.jsx)(p,{initialData:e,onSubmit:I,onCancel:()=>T(!1),members:d,isSaving:B,isSubForm:!0})}):(0,t.jsxs)("div",{className:m.default.treeNode,children:[a>0&&(0,t.jsx)("div",{className:m.default.guideLineV})," ",a>0&&(0,t.jsx)("div",{className:m.default.guideLineH}),(0,t.jsxs)("div",{className:`${m.default.taskWrapper} ${a>0?m.default.taskWrapperChild:""}`,children:[(0,t.jsxs)("div",{className:`${m.default.taskCard} group ${q?m.default.taskCardActive:m.default.taskCardDisabled}`,children:[(0,t.jsxs)("div",{className:m.default.taskLeft,children:[(0,t.jsx)("button",{onClick:()=>y(!j),className:`${m.default.expandBtn} ${!e.subTasks?.length?"invisible":""}`,children:(0,t.jsx)("span",{className:`text-xs transform transition-transform duration-200 ${j?"rotate-90":""}`,children:"â–¶"})}),(0,t.jsxs)("div",{className:m.default.taskInfo,children:[(0,t.jsxs)("div",{className:m.default.taskHeader,children:[(0,t.jsx)("span",{className:`${m.default.taskTitle} ${"DONE"===e.status?m.default.taskTitleDone:""}`,children:e.title}),(0,t.jsx)("span",{className:`${m.default.badgePriority} ${"URGENT"===(x=e.priority)?m.default.badgeUrgent:"HIGH"===x?m.default.badgeHigh:"LOW"===x?m.default.badgeLow:m.default.badgeMedium}`,children:e.priority}),$&&(0,t.jsxs)("div",{className:m.default.editActions,children:[(0,t.jsx)("button",{onClick:()=>T(!0),className:m.default.iconBtn,title:"Sá»­a",children:"âœï¸"}),(0,t.jsx)("button",{onClick:()=>u("TASK",e.id,e.title),className:m.default.iconBtnDelete,title:"XÃ³a",children:"ğŸ—‘ï¸"})]})]}),e.description&&(0,t.jsx)("p",{className:m.default.taskDesc,children:e.description}),(0,t.jsxs)("div",{className:m.default.taskMeta,children:[(0,t.jsxs)("div",{className:m.default.metaItem,title:"NgÆ°á»i thá»±c hiá»‡n",children:["ğŸ‘¤"," ",(0,t.jsx)("span",{className:"font-medium text-gray-700",children:w})]}),"DONE"===e.status&&e.completed_at?(0,t.jsxs)("div",{className:"flex items-center gap-1 text-green-600 bg-green-50 px-1.5 rounded border border-green-100",title:"HoÃ n thÃ nh lÃºc",children:["ğŸ ",_(e.completed_at)]}):e.due_date&&(0,t.jsxs)("div",{className:`flex items-center gap-1 px-1.5 rounded ${new Date(e.due_date)<new Date?"text-red-600 bg-red-50":"text-orange-600 bg-orange-50"}`,title:"Háº¡n chÃ³t",children:["ğŸ“… ",_(e.due_date)]}),"DONE"!==e.status&&(0,t.jsxs)("div",{className:m.default.metaItem,title:"NgÃ y táº¡o",children:["ğŸ•’"," ",(0,t.jsx)("span",{className:"text-gray-400",children:_(e.created_at)})]})]})]})]}),(0,t.jsxs)("div",{className:m.default.taskRight,children:[$&&(0,t.jsx)("button",{onClick:()=>v(!b),className:m.default.addSubBtn,children:"+ Con"}),(0,t.jsxs)("select",{value:e.status,onChange:e=>D(e.target.value),disabled:!q||k,className:(g=m.default.statusSelectSmall,q?(g+=" hover:bg-opacity-80 ","DONE"===e.status)?g+" "+m.default.statusDone:"IN_PROGRESS"===e.status?g+" "+m.default.statusProgress:g+" "+m.default.statusDefault:`${g} ${m.default.statusSelectDisabled}`),children:[(0,t.jsx)("option",{value:"TODO",children:"TODO"}),(0,t.jsx)("option",{value:"IN_PROGRESS",children:"IN PROGRESS"}),(0,t.jsx)("option",{value:"REVIEW",children:"REVIEW"}),(0,t.jsx)("option",{value:"DONE",children:"DONE"})]})]})]}),(0,t.jsx)("div",{className:"ml-4 pl-4 border-l-2 border-gray-100",children:(0,t.jsx)(c,{taskId:e.id,token:n,canEdit:$||e.assignee_id===o?.id})}),b&&(0,t.jsx)("div",{className:m.default.taskWrapperChild,children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"text-gray-300 text-2xl leading-none mt-[-5px]",children:"â†³"}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(p,{onSubmit:O,onCancel:()=>v(!1),members:d,isSaving:B,isSubForm:!0})})]})}),j&&e.subTasks?.map(e=>(0,t.jsx)(f,{task:e,level:a+1,projectId:l,token:n,onRefresh:r,members:d,currentUser:o,onRequestDelete:u},e.id))]})]})};function g(){let e=(0,l.useSearchParams)().get("id"),{user:o,token:c}=(0,a.useAuth)(),[x,_]=(0,s.useState)(null),[g,j]=(0,s.useState)([]),[y,b]=(0,s.useState)([]),[v,N]=(0,s.useState)(!0),[T,B]=(0,s.useState)(!1),[S,k]=(0,s.useState)(!1),[C,q]=(0,s.useState)("TASKS"),[$,w]=(0,s.useState)(""),[D,I]=(0,s.useState)(""),[O,A]=(0,s.useState)(!1),[L,E]=(0,s.useState)(""),[R,M]=(0,s.useState)(!1),[P,H]=(0,s.useState)([]),[F,W]=(0,s.useState)({isOpen:!1,type:null,id:null,title:"",message:""}),[z,G]=(0,s.useState)(!1),U=async()=>{if(c&&e)try{let t=new URLSearchParams;$&&t.append("priority",$),D&&t.append("status",D);let s=t.toString()?`?${t.toString()}`:"",[a,l,i]=await Promise.all([fetch(`${h}/projects`,{headers:{Authorization:`Bearer ${c}`}}),fetch(`${h}/projects/${e}/tasks${s}`,{headers:{Authorization:`Bearer ${c}`}}),fetch(`${h}/projects/${e}/members`,{headers:{Authorization:`Bearer ${c}`}})]);if(a.ok){let t=await a.json();_(t.find(t=>t.id===parseInt(e)))}l.ok&&j(await l.json()),i.ok&&b(await i.json())}catch(e){console.error(e)}finally{N(!1)}};(0,s.useEffect)(()=>{c&&e&&U()},[c,e,$,D]);let K=async t=>{if(x){k(!0);try{let s=await fetch(`${h}/projects/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({status:t})}),a=await s.json();if(!s.ok)throw Error(a.message);_(e=>({...e,status:t})),i.default.success(`Dá»± \xe1n: ${t}`)}catch(e){i.default.error(e.message)}finally{k(!1)}}},V=async t=>{B(!0);try{await fetch(`${h}/projects/${e}/tasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({...t,assignee_id:t.assignee_id||null})}),B(!1),U(),i.default.success("ÄÃ£ táº¡o nhÃ³m cÃ´ng viá»‡c")}catch(e){i.default.error("Lá»—i táº¡o")}},J=async()=>{A(!0);try{let e=await fetch(`${h}/users?limit=100`,{headers:{Authorization:`Bearer ${c}`}});if(e.ok){let t=await e.json(),s=t.data||t,a=new Set(y.map(e=>e.id));H(s.filter(e=>!a.has(e.id)&&"ADMIN"!==e.role))}}catch(e){}},X=async t=>{if(t.preventDefault(),!L)return i.default.error("Vui lÃ²ng chá»n thÃ nh viÃªn");M(!0);try{let t=await fetch(`${h}/projects/${e}/members`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({email:L})}),s=await t.json();t.ok?(i.default.success("ÄÃ£ thÃªm thÃ nh viÃªn!"),E(""),U(),H(e=>e.filter(e=>e.email!==L))):i.default.error(s.message||"Lá»—i má»i")}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{M(!1)}},Q=(e,t,s)=>{W({isOpen:!0,type:e,id:t,title:`X\xf3a ${"TASK"===e?"cÃ´ng viá»‡c":"thÃ nh viÃªn"}?`,message:`Báº¡n c\xf3 cháº¯c muá»‘n x\xf3a ${s}?`})},Y=async()=>{G(!0);try{let t="TASK"===F.type?`${h}/projects/${e}/tasks/${F.id}`:`${h}/projects/${e}/members/${F.id}`;(await fetch(t,{method:"DELETE",headers:{Authorization:`Bearer ${c}`}})).ok?(i.default.success("ÄÃ£ xÃ³a"),U()):i.default.error("KhÃ´ng thá»ƒ xÃ³a")}catch(e){i.default.error("Lá»—i káº¿t ná»‘i")}finally{G(!1),W({...F,isOpen:!1})}},Z=o?.role==="ADMIN"||o?.role==="PM"&&x?.created_by===o.id;return e?v?(0,t.jsx)("div",{className:"p-8 text-center",children:"Äang táº£i..."}):(0,t.jsxs)("div",{className:m.default.container,children:[(0,t.jsx)("header",{className:m.default.header,children:(0,t.jsxs)("div",{className:m.default.headerContent,children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:m.default.projectTitleWrapper,children:[(0,t.jsx)("h1",{className:m.default.projectTitle,children:x?.name||`Dá»± \xe1n #${e}`}),(0,t.jsx)("span",{className:`${m.default.projectStatus} ${x?.status==="COMPLETED"?m.default.statusCompleted:m.default.statusProgress}`,children:x?.status})]}),(0,t.jsx)("div",{className:"flex items-center gap-4 mt-2",children:(0,t.jsxs)("button",{onClick:J,className:m.default.memberBtn,children:["ğŸ‘¥ ",y.length," ThÃ nh viÃªn"]})})]}),(0,t.jsxs)("div",{className:m.default.headerActions,children:[(0,t.jsx)("div",{className:"mr-2",children:(0,t.jsx)(u.default,{})}),o?.role==="ADMIN"||o?.role==="PM"&&x?.created_by===o?.id?(0,t.jsxs)("div",{className:m.default.projectStatusSelectWrapper,children:[(0,t.jsx)("span",{className:m.default.projectStatusLabel,children:"Tráº¡ng thÃ¡i:"}),(0,t.jsxs)("select",{value:x?.status||"IN_PROGRESS",onChange:e=>K(e.target.value),disabled:S,className:m.default.projectStatusSelect,children:[(0,t.jsx)("option",{value:"IN_PROGRESS",children:"Äang triá»ƒn khai"}),(0,t.jsx)("option",{value:"COMPLETED",children:"ÄÃ£ hoÃ n thÃ nh"})]})]}):null,(o?.role==="ADMIN"||o?.role==="PM")&&!T&&"TASKS"===C&&(0,t.jsxs)("button",{onClick:()=>B(!0),className:m.default.createTaskBtn,children:[(0,t.jsx)("span",{children:"+"})," Viá»‡c má»›i"]})]})]})}),(0,t.jsxs)("div",{className:m.default.tabContainer,children:[(0,t.jsx)("button",{onClick:()=>q("TASKS"),className:`${m.default.tabBtn} ${"TASKS"===C?m.default.tabActive:m.default.tabInactive}`,children:"Danh sÃ¡ch cÃ´ng viá»‡c"}),(0,t.jsx)("button",{onClick:()=>q("REPORT"),className:`${m.default.tabBtn} ${"REPORT"===C?m.default.tabActive:m.default.tabInactive}`,children:"BÃ¡o cÃ¡o tiáº¿n Ä‘á»™"})]}),(0,t.jsx)("main",{className:m.default.mainContent,children:"TASKS"===C?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("h3",{className:"font-bold text-gray-700",children:["CÃ´ng viá»‡c (",g.length,")"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Lá»c Æ°u tiÃªn:"}),(0,t.jsxs)("select",{className:"text-xs border border-gray-300 rounded px-2 py-1 outline-none focus:border-indigo-500 cursor-pointer",value:$,onChange:e=>w(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Táº¥t cáº£"}),(0,t.jsx)("option",{value:"URGENT",children:"Kháº©n cáº¥p"}),(0,t.jsx)("option",{value:"HIGH",children:"Cao"}),(0,t.jsx)("option",{value:"MEDIUM",children:"Trung bÃ¬nh"}),(0,t.jsx)("option",{value:"LOW",children:"Tháº¥p"})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"Tráº¡ng thÃ¡i:"}),(0,t.jsxs)("select",{className:"text-xs border border-gray-300 rounded px-2 py-1 outline-none focus:border-indigo-500 cursor-pointer",value:D,onChange:e=>I(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Táº¥t cáº£"}),(0,t.jsx)("option",{value:"TODO",children:"Cáº§n lÃ m"}),(0,t.jsx)("option",{value:"IN_PROGRESS",children:"Äang lÃ m"}),(0,t.jsx)("option",{value:"REVIEW",children:"Review"}),(0,t.jsx)("option",{value:"DONE",children:"HoÃ n thÃ nh"})]})]})]}),T&&(0,t.jsx)("div",{className:m.default.formContainer,children:(0,t.jsx)(p,{onSubmit:V,onCancel:()=>B(!1),members:y,isSaving:!1})}),(0,t.jsx)("div",{className:"space-y-4",children:g.length>0?g.map(s=>(0,t.jsx)(f,{task:s,projectId:e,token:c,onRefresh:U,members:y,currentUser:o,onRequestDelete:Q},s.id)):!T&&(0,t.jsx)("div",{className:"text-center py-20 bg-white rounded-xl border-2 border-dashed border-gray-300",children:(0,t.jsx)("p",{className:"text-gray-500",children:"KhÃ´ng tÃ¬m tháº¥y cÃ´ng viá»‡c nÃ o."})})})]}):(0,t.jsx)(d,{projectId:e,token:c})}),O&&(0,t.jsx)("div",{className:m.default.modalOverlay,children:(0,t.jsxs)("div",{className:m.default.modalContainer,children:[(0,t.jsxs)("div",{className:m.default.modalHeader,children:[(0,t.jsx)("h3",{className:m.default.modalTitle,children:"ThÃ nh viÃªn dá»± Ã¡n"}),(0,t.jsx)("button",{onClick:()=>A(!1),className:m.default.closeBtn,children:"Ã—"})]}),(0,t.jsxs)("div",{className:m.default.modalBody,children:[Z&&(0,t.jsxs)("form",{onSubmit:X,className:m.default.inviteForm,children:[(0,t.jsxs)("select",{className:m.default.inputField,value:L,onChange:e=>E(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"-- Chá»n nhÃ¢n viÃªn --"}),P.map(e=>(0,t.jsxs)("option",{value:e.email,children:[e.username," (",e.email,")"]},e.id)),0===P.length&&(0,t.jsx)("option",{disabled:!0,children:"Háº¿t nhÃ¢n viÃªn"})]}),(0,t.jsx)("button",{type:"submit",disabled:R||!L,className:m.default.btnSave,children:R?"...":"ThÃªm"})]}),(0,t.jsx)("div",{className:m.default.memberList,children:y.map(e=>(0,t.jsxs)("div",{className:m.default.memberRow,children:[(0,t.jsxs)("div",{className:m.default.memberInfo,children:[(0,t.jsx)(n.default,{name:e.username,size:"md"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium text-sm text-gray-900",children:e.username}),e.is_manager&&(0,t.jsx)("span",{className:"text-xs text-yellow-500",children:"â­"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:`${m.default.memberRoleBadge} ${"ADMIN"===e.role?m.default.roleAdmin:"PM"===e.role?m.default.rolePM:m.default.roleMember}`,children:e.role}),Z&&e.id!==x?.created_by&&e.id!==o.id&&(0,t.jsx)("button",{onClick:()=>Q("MEMBER",e.id,e.username),className:m.default.iconBtnDelete,children:"ğŸ—‘ï¸"})]})]},e.id))})]}),(0,t.jsx)("div",{className:m.default.modalFooter,children:(0,t.jsx)("button",{onClick:()=>A(!1),className:m.default.btnCancel,children:"ÄÃ³ng"})})]})}),(0,t.jsx)(r.default,{isOpen:F.isOpen,title:F.title,message:F.message,onConfirm:Y,onCancel:()=>W({...F,isOpen:!1}),isLoading:z})]}):(0,t.jsx)("div",{className:"p-8",children:"Dá»± Ã¡n khÃ´ng tá»“n táº¡i"})}function j(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"p-8 text-center",children:"Äang táº£i..."}),children:(0,t.jsx)(g,{})})}e.s(["default",()=>j],18512)}]);